<!DOCTYPE html>
<html lang='en'>
<head>   
   <meta charset='UTF-8' />
   <meta name="viewport" context="width=device-width, initial-scale=1.0" />
   <title>A Were-Wolf Guide</title>   
   <meta name="discription" content="WoD, WhiteWolf, Werewolf" />
   <meta name="version" content="v1.2" />
   <meta name="author" content="Orsaion" />

   <!-- Eventually this block will be moved to seperate file(s) to speed up 
    page load. Some functions are already in another js file. -->
   <script>
       //"use strict";

       /** Function runes() is going to be a random dice roll gen. It's going to
       * be modified a little to make it operate within the rules of the WOD
       * system. Users will put numbers in text fields for dice and scale, those
       * will be validated, then put through the success/failure system. Which 
       * is determined by the number of dice above the difficulty given. (If 3
       * dice are rolled - 4,5,6 - with difficulty of 6, there is one success.)
       * Also checks for a 'botch' or a really bad roll where there are no 
       * successes and more than one "1" showing up.
       */
       function rpOpen() { rP1.style.display= "block"; }
       function runes() {
            var d = document.getElementById("dice").value;
            var s = document.getElementById("dScale").value;
            var ran = []; 
            var n = 1; var x = 0;
            var pass = 0; var fail = 0; 
            var output; var rsof;
            
            if (d == null || d == "" || d > 25 ) {
               output = "How many dice again?";
               ran.length = 0; // clear array to trigger the error below
            } else if (s == null || s == "" || s >= 11 || s <= 2 ) {
               output = "How hard of a check?"
               ran.length = 0;
            } else {
               output = "Rolled " + d + "d10 on " + s + "+";

               // this builds the ran[] with "random dice rolls" 
               while ( n <= d ) {
                    ran.push( Math.floor( Math.random() * 10 + 1 ) )
                    n++;
                } 
            }            
            // check to see if any number in the array passes or fails
            while ( x <= ( d - 1) ) {
                //x++;
                if ( ran[x] > s  || ran[x] == s ) {
                    pass++; 
                    fail--;
                } else if ( ran[x] == 1 ) {
                    pass--; 
                    fail++;
                } 
                x++;
            } 
            // tally success rate or failure and return result
            if ( pass == 1 ) {
               rsof = '<p id="rResult" class="runeText" style="color: green">' + 
                   pass + " success! With a roll of " + ran + "</p>";
           } else if ( pass >= 2 ) {
               rsof = '<p id="rResult" class="runeText" style="color: green">' + 
                   pass + " successes! With a roll of " + ran + "</p>";
           } else if ( ran.length == 0 ) { // disables text for bad input
               rsof = '<p id="rResult" class="runeText"></p>';
           } else if ( ran.length != 0 && pass == 0 && fail == 0 ) {
               rsof = '<p id="rResult" class="runeText">Fail, with a roll of ' +
                    ran + '</p>';
           } else if ( pass <= 0 && fail >= 1 ) {
               rsof = '<p id="rResult" class="runeText" style="color: red">' +
                   'Botch! With a roll of ' + ran + '</p>';
           } else {
               rsof = '<p id="rResult" class="runeText">Fail, with a roll of ' +
                    ran + '</p>';
           }

           document.getElementById("iEcho").innerText= output + "...";
           document.getElementById("rResult").innerHTML= rsof;
           ran.length = 0;
            
       }
       function rpClose() { rP1.style.display= "none"; } 

       /** Function intro() will clear out the text area and display the opening
       * story that's first loaded when you reach the page.
       */
       function intro(num) {
            var x = new XMLHttpRequest();
                x.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        var r = JSON.parse(x.responseText); 
                        document.getElementById('textBody').innerHTML= r.open;
                    }
                };
                x.open('GET', 'open.json', true);
                x.send();
            if (num == 1) {                
                textBody.style.display= "block";
                noteBtns.style.display= "none";
                noteArea.style.display= "none";
            } 
       }
       /** Function notes() will hide the main article area and display the div
       * containing the buttons and textarea for the Notes section.
       */
       function switchNotes() {
           textBody.style.display= "none";
           noteBtns.style.display= "block";
           noteArea.style.display= "block";
       }
       /** This function I may just remake to a different HTML page. Either way
       * it's going to be a character sheet that includes the dice roller from
       * above tacked on the side so it's always availble. 
       */
       function charSheet() {
       }
       /** Function switchChap will hide the div containing the buttons and
       * text area for the note Section. Then reenable the main article div so 
       * the user can continue to scan the chapters/sections again.
       */
       function switchChap() {
           textBody.style.display= "block";
           noteBtns.style.display= "none";
           noteArea.style.display= "none";
       }

       /** All of the following functions are going to be used to access 
       * different parts of the main database. The call will come in looking for
       * specific portions, then alter the article div to display the HTML code.
       * All the information in the db has been written as formatted and tagged 
       * HTML allowing them to be stylized upon load. Because some parts will 
       * pull several different db sectors, this pre-fab code helps maintain a 
       * consistant look and feel of the article div/text.
       */
       function changeText() { 
           // until I have the SQL DB up and running, I've put in test code to 
           // make sure everything works. This will be changed later on.        
           document.getElementById("textBody").innerHTML="<p>Half human. Half" +
           " beast. Predators that stalk the deepest woods and the darkest " +
           "urban alleyways. Monsters that creep up on their prey like ghosts, "
           + "open explode into a fury of claws and fangs. Beasts that howl " +
           "under the full moon and kill those that cross the boundaries of " +
           "their territory...</p>" + "<p><b><i>Werewolves.</i></b></p>";
           
           // adding ability to change back to chapters by clicking on btns
           textBody.style.display= "block";
           noteBtns.style.display= "none";
           noteArea.style.display= "none";
       }
       function changeBack() { 
           document.getElementById("textBody").innerHTML="<p>And now, for " +
           "something completely different...</p>";

           textBody.style.display= "block";
           noteBtns.style.display= "none";
           noteArea.style.display= "none";
       } 
       function change3() {
            document.getElementById("textBody").innerHTML="<p><em>Add some " +
            "stuff from Ch3...</em></p>";

           textBody.style.display= "block";
           noteBtns.style.display= "none";
           noteArea.style.display= "none";
       }
       function change4() {
            document.getElementById("textBody").innerHTML='<img src="wolf.png"' 
            + 'width="500" height="500" alt="wolf picture"></img>';

           textBody.style.display= "block";
           noteBtns.style.display= "none";
           noteArea.style.display= "none";
       }
       function change5() {
            document.getElementById("textBody").innerHTML="Add some stuff from" 
            + " Ch5...";

           textBody.style.display= "block";
           noteBtns.style.display= "none";
           noteArea.style.display= "none";
       }
       function change6() {
            document.getElementById("textBody").innerHTML="Add some stuff from"
            + " Ch6...";

           textBody.style.display= "block";
           noteBtns.style.display= "none";
           noteArea.style.display= "none";
       }
       function change7() {
            document.getElementById("textBody").innerHTML="Add some stuff from"
            + " Ch7...";

           textBody.style.display= "block";
           noteBtns.style.display= "none";
           noteArea.style.display= "none";
       }
       function change8() {
            document.getElementById("textBody").innerHTML="Add some stuff from" 
            + " Ch8...";

           textBody.style.display= "block";
           noteBtns.style.display= "none";
           noteArea.style.display= "none";
       }
       function change9() {
            document.getElementById("textBody").innerHTML="Add some stuff from" 
            + " Ch9...";

           textBody.style.display= "block";
           noteBtns.style.display= "none";
           noteArea.style.display= "none";
       }
       function soupDrinker() {
            document.getElementById("textBody").innerHTML="<p><em>What are you" 
            + " doing?</em></p> <p>It is not time to drink soup!</p>";

           textBody.style.display= "block";
           noteBtns.style.display= "none";
           noteArea.style.display= "none";
       } 
       /* end of text change functions for the moment */


       /** Function getNote() will make a call to the local storage area client-
       * side to grab a previously saved file then load that into the text area
       * so the user can read/edit it.
       */
       function getNote(file, location) {
            // using a test file for the moment.
            var x = new XMLHttpRequest();
            x.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var r = JSON.parse(x.responseText);
                    document.getElementById('noteArea').innerText= r.note;
                }
            };
            x.open('GET', file, true);
            x.send();
       }
       /** Function saveNote() will allow the user to save a file to the client-
       * side local storage device that can be pulled later on with getNote(). 
       * All content in the textArea will be copied to the file.
       */
       function saveNote() {
            var note = document.getElementById('noteArea').value;
            var nJSON;
            
            if (note != null && note.length >= 1) {                
                nJSON = '{"note":' + JSON.stringify(note) + '}';
                console.log(nJSON);

                // still learning how to save locally

            } else { alert("No text detected..."); }
       }
       /** Function clearNote() removes all text from noteArea */
       function clearNote() {           
           if ( confirm("Are you sure you want to remove all notes?") ) {
               document.getElementById('noteArea').innerText = "";
               
           }
       }
   
   </script>

    <link rel="stylesheet" href="wodCss.css" /> 
    <!-- external CSS for printing and normal layout added. I'll leave style
        tag here though to qickly change things as I go before adding it to main
        css file. -->
   <style>
   </style> 

</head>

<body>
    <header>World of Darkness : Werewolf</header>

    <section>
    <div>
        <top> 
            <button type="button" onclick="intro(1)">Opening Text</button>
            <button type="button">Characters</button> <!-- might change this to a link -->
            <button type="button" onclick="rpOpen()">Chance Runes</button>            
            <button type="button" onclick="switchNotes()">Take a Note</button>
            <button type="button" onclick="switchChap()">Read a Page</button>
        </top>
    </div>
    </section>

    <nav>
        <chapter> 
            <!-- there was an error with the first one not rendering correctly
            so I just made it a fake header for the setion -->
            <button class="accordionTitle">Chapters</button>

            <!-- Eventually these will reflect the correct blurbs of text too
            but for now these buttons are just here to make sure everything is
            working correctly. -->
            <button class="accordion">A World of Darkness</button>
            <div class="panel">
                <button class="button" onclick="changeText()">Section 1</button>
                <button class="button" onclick="changeBack()">Section 2</button>
                <button class="button" onclick="change3()">Section 3</button>
                <button class="button" onclick="change4()">Das Wolfy</button>
                <button class="button" onclick="soupDrinker()">Soup!</button>                    
            </div>

            <button class="accordion">The Garou</button>
            <div class="panel">
                <button class="button" onclick="changeText()">Chapter 1</button>
                <button class="button" onclick="changeBack()">Chapter 2</button>
                <button class="button" onclick="change3()">Chapter 3</button>
                <button class="button" onclick="change4()">Das Wolfy</button>
                <button class="button" onclick="soupDrinker()">Soup!</button>  
            </div>

            <button class="accordion">Characters and Traits</button>
            <div class="panel">
                <button class="button" onclick="changeText()">Chapter 1</button>
                <button class="button" onclick="changeBack()">Chapter 2</button>
                <button class="button" onclick="change3()">Chapter 3</button>
                <button class="button" onclick="change4()">Das Wolfy</button>
                <button class="button" onclick="soupDrinker()">Soup!</button>  
            </div>

            <button class="accordion">Gifts and Rites</button>
            <div class="panel">
                <button class="button" onclick="changeText()">Chapter 1</button>
                <button class="button" onclick="changeBack()">Chapter 2</button>
                <button class="button" onclick="change3()">Chapter 3</button>
                <button class="button" onclick="change4()">Das Wolfy</button>
                <button class="button" onclick="soupDrinker()">Soup!</button>  
            </div>

            <button class="accordion">Rules</button>
            <div class="panel">
                <button class="button" onclick="changeText()">Chapter 1</button>
                <button class="button" onclick="changeBack()">Chapter 2</button>
                <button class="button" onclick="change3()">Chapter 3</button>
                <button class="button" onclick="change4()">Das Wolfy</button>
                <button class="button" onclick="soupDrinker()">Soup!</button>  
            </div>

            <button class="accordion">Systems and Drama</button>
            <div class="panel">
                <button class="button" onclick="changeText()">Chapter 1</button>
                <button class="button" onclick="changeBack()">Chapter 2</button>
                <button class="button" onclick="change3()">Chapter 3</button>
                <button class="button" onclick="change4()">Das Wolfy</button>
                <button class="button" onclick="soupDrinker()">Soup!</button>  
            </div>

            <button class="accordion">The Umbra</button>
            <div class="panel">
                <button class="button" onclick="changeText()">Chapter 1</button>
                <button class="button" onclick="changeBack()">Chapter 2</button>
                <button class="button" onclick="change3()">Chapter 3</button>
                <button class="button" onclick="change4()">Das Wolfy</button>
                <button class="button" onclick="soupDrinker()">Soup!</button>  
            </div>

            <button class="accordion">Storytelling</button>
            <div class="panel">
                <button class="button" onclick="changeText()">Chapter 1</button>
                <button class="button" onclick="changeBack()">Chapter 2</button>
                <button class="button" onclick="change3()">Chapter 3</button>
                <button class="button" onclick="change4()">Das Wolfy</button>
                <button class="button" onclick="soupDrinker()">Soup!</button>  
            </div>

            <button class="accordion">Antagonists</button>
            <div class="panel">
                <button class="button" onclick="changeText()">Chapter 1</button>
                <button class="button" onclick="changeBack()">Chapter 2</button>
                <button class="button" onclick="change3()">Chapter 3</button>
                <button class="button" onclick="change4()">Das Wolfy</button>
                <button class="button" onclick="soupDrinker()">Soup!</button>  
            </div>

            <button class="accordion">Allies and Ammunition</button>
            <div class="panel">
                <button class="button" onclick="changeText()">Chapter 1</button>
                <button class="button" onclick="changeBack()">Chapter 2</button>
                <button class="button" onclick="change3()">Chapter 3</button>
                <button class="button" onclick="change4()">Das Wolfy</button>
                <button class="button" onclick="soupDrinker()">Soup!</button>  
            </div>

            <script>
                /** This simply gathers all the different chapters and allows 
                * the animation of the accordian buttons to work.
                */
                "use strict";
                var acc = document.getElementsByClassName("accordion");
                var i;

                // populate and create action for clicking on accordion buttons
                for (i = 0; i < acc.length; i++) {
                    acc[i].addEventListener("click", function() {
                    this.classList.toggle("active");
                    
                    // build hidden/shown subsections
                    var panel = this.nextElementSibling;
                    if (panel.style.display === "block") {
                      panel.style.display = "none";
                    } else {
                      panel.style.display = "block";
                    } 
                    });
                }
            </script>

         </chapter>
    </nav>

    <article>
        <div id="textBody" class="textBody"> 
            <script>intro(2);</script>            
        </div>
        <div id="noteBtns" style="display: none">
            <button type"button" id="open" class="buttonNote" style="width: 24%" 
            onclick="getNote('test.json', null)">Open previous note</button> 
            <button type"button" id="save" class="buttonNote" style="width: 24%"
            onclick="saveNote()">Save a note for later</button>
            <button type"button" id="print" class="buttonNote" style="width: 
            24%" onclick="printNote()">Print your note</button>
            <button type"button" id="clear" class="buttonNote" style="width:
            24%" onclick="clearNote()">Clear All Notes</button>
        </div>
            <!-- There's an annoying thing I noticed when using the text box, 
            every time that I push the tab button it seems to change what is 
            focused as opposed actually indenting like in a normal text editor. 
            I'll have to look into that later on. -->
        <br /><textarea id="noteArea" class="noteTextArea" rows="15" cols="61"
            style="display: none" placeholder="You can resize this by clicking 
            then dragging in the bottom right"></textarea>       
    </article>

    <div id="rP1" class="runePanel">
            <h3>What does fate dictate?</h3>
            
            <br />What is your dice pool?<br />
            <input type="number" id="dice" min="1" max="3">
            <br /><br />What is your difficulty?<br />
            <input type="number" id="dScale" min="1" max="3">
            <br /><br />
            <input type="button" class="runeButton" onclick="runes()" 
                value="Let Fate Decide">
            <br /><br />
            <p id="iEcho" class="runeText"></p>
            <p id="rResult" class="runeText"></p>
            <br /><br/>
            <button type"button" class="runeButton" onclick="rpClose()">Put the 
                Runes away</button>
    </div>

    <script src="wodScripts.js"></script>

</body> 

    <!-- to do: put an animation in bottom left 
    <div id="animation"></div> -->

</html>